<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Antimalarial Resistance • malariasimulation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Antimalarial Resistance">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">malariasimulation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Model.html">Model Introduction</a>
    </li>
    <li>
      <a href="../articles/Demography.html">Demography</a>
    </li>
    <li>
      <a href="../articles/Treatment.html">Treatment</a>
    </li>
    <li>
      <a href="../articles/MDA.html">MDA and Chemoprevention</a>
    </li>
    <li>
      <a href="../articles/Vaccines.html">Vaccines</a>
    </li>
    <li>
      <a href="../articles/VectorControl_Bednets.html">Vector Control: Bednets</a>
    </li>
    <li>
      <a href="../articles/VectorControl_IRS.html">Vector Control: Indoor Residual Spraying</a>
    </li>
    <li>
      <a href="../articles/SetSpecies.html">Mosquito Species</a>
    </li>
    <li>
      <a href="../articles/Carrying-capacity.html">Carrying Capacity</a>
    </li>
    <li>
      <a href="../articles/EIRprevmatch.html">Matching PfPR2-10 to EIR</a>
    </li>
    <li>
      <a href="../articles/Metapopulation.html">Metapopulation Modelling</a>
    </li>
    <li>
      <a href="../articles/Variation.html">Stochastic Variation</a>
    </li>
    <li>
      <a href="../articles/Parameter_variation.html">Parameter Variation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/malariasimulation" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Antimalarial Resistance</h1>
            
      

      <div class="hidden name"><code>Antimalarial_Resistance.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load the requisite packages:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">malariasimulation</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set colour palette:</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#CC79A7"</span>,<span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>One of the major threats to the continued success of efforts to
reduce the burden of malaria is the evolution and spread of resistance
to the antimalarial drugs used to treat uncomplicated cases of malaria.
The most effective frontline antimalarials are a class of drugs called
artemisinin combination therapies (ACTs). ACTs combine a fast-acting,
short-lived artemisinin derivative (e.g. artemether), with a
slower-acting, longer-lasting partner drug (e.g. lumefantrine) that
clears the remaining parasites from the patient’s system. Efforts to
understand the effect of resistance to ACTs on malaria morbidity and
mortality, and to develop strategies to control or mitigate the spread
of resistance, would benefit from insights derived from mathematical
modelling. Building on the model developed by Slater et al. (2016),
<code>malariasimulation</code> provides the functionality to simulate
the effects of resistance to the artemisinin and/or partner drug
components to multiple, independent ACTs, on malaria transmission
dynamics.</p>
<p>Resistance to the artemisinin component of an ACT can result either
in slow parasite clearance (SPC), in which treatment with an ACT takes
longer than 3 days to fully clear patients with resistant parasites, or
early treatment failure (ETF), in which the ACT fails to clear the
infection and the individual develops a clinical infection. Resistance
to the partner drug, where the partner drug fails to clear the parasite
after the artemisinin derivative is depleted, results in infections
recrudescing to either clinical (D) or asymptomatic infections (A).
Resistance to the partner drug can also result in individuals developing
a novel, resistant infection following treatment, as the prophylaxis
provided by the ACT fails to protect the individual against reinfection
by a resistant strain. In the following vignette, we illustrate how to
parameterise and run <code>malariasimulation</code> simulations with
resistance to ACTs deployed as a clinical treatment</p>
</div>
<div class="section level2">
<h2 id="using-set_antimalarial_resistance-to-parameterise-resistance">Using set_antimalarial_resistance() to parameterise resistance<a class="anchor" aria-label="anchor" href="#using-set_antimalarial_resistance-to-parameterise-resistance"></a>
</h2>
<p>Simulations capturing the effects of resistance to clinical treatment
using antimalarial drugs are parameterised using the
<code><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance()</a></code> function. This function
appends user-defined resistance parameters to a
<code>malariasimulation</code> parameter list and accepts ten inputs.
The first is a list of <code>malariasimulation</code> parameters to
append the resistance parameters to, and the second the index of the
<code>drug</code> for which resistance is being parameterised, as set
using the <code><a href="../reference/set_drugs.html">set_drugs()</a></code> function. The
<code><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance()</a></code> function requires the
<code>timesteps</code>, <code>artemisinin_resistance_proportion</code>,
<code>partner_drug_resistance_proportion_proportion</code>,
<code>slow_parasite_clearance_probability</code>,
<code>early_treatment_failure_probability</code>,
<code>late_clinical_failure_probability</code>,
<code>late_parasitological_failure_prob</code>, and
<code>reinfection_during_prophylaxis_probability</code> inputs to be of
equal length so that, for each time step in which an update occurs, a
value is available for each parameter. Finally, the
<code>slow_parasite_clearance_time</code> parameter represents the mean
residence time, in days, for artemisinin-resistant individuals
experiencing slow parasite clearance (SPC) in the Treated compartment,
and must be input as a single, positive value.</p>
</div>
<div class="section level2">
<h2 id="simulating-static-resistance">Simulating static resistance<a class="anchor" aria-label="anchor" href="#simulating-static-resistance"></a>
</h2>
<p>To illustrate how to parameterise resistance to an ACT using the
<code><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance()</a></code> function, we’ll set-up and
run three simulations. The first simulates malaria transmission in the
absence of interventions or resistance. The second simulates a simple
regime of clinical treatment in which 80% of clinical cases are treated
with artemether lumefantrine (AL), beginning after one year, in the
absence of antimalarial resistance. The third simulates the same
clinical treatment programme but with resistance to the artemisinin
component of AL emerging after two years. For illustrative purposes, we
assume that the proportion of infections resistant to the artemisinin
component of AL increases from 0% to 80%, and that these infections have
a 90% chance of resulting in early treatment failure.</p>
<div class="section level3">
<h3 id="parameterisation">Parameterisation<a class="anchor" aria-label="anchor" href="#parameterisation"></a>
</h3>
<p>First, we load the default <code>malariasimulation</code> model
parameters, using the <code>overrides</code> argument to increase the
human population. The human and mosquito population parameters are then
calibrated to a user-specified initial EIR using the
<code><a href="../reference/set_equilibrium.html">set_equilibrium()</a></code> function. Next, we load the in-built
parameters for the antimalarial drug AL and append them to the parameter
list using <code><a href="../reference/set_drugs.html">set_drugs()</a></code>. We can then use
<code><a href="../reference/set_clinical_treatment.html">set_clinical_treatment()</a></code> to specify a clinical treatment
regime, beginning after one year, that treats, on average, 80% of the
clinical cases of malaria with AL (<code>AL_params</code>). The
<code><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance()</a></code> function is then used to
specify a scenario in which resistance is initially absent from the
population, but after two years the proportion of malaria infections
that are resistant to the artemisinin component of AL rises to 80%. We
also set the probability that artemisinin-resistant infections result in
early treatment failure to 0.9. In the current instance, we’ve set the
proportion of infections resistant to the AL partner drug to 0% and the
probabilities of other resistant infection outcomes to zero for
simplicity.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Specify the time steps over which to simulate:</span></span>
<span><span class="va">timesteps</span> <span class="op">&lt;-</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Specify an initial EIR to calibrate to:</span></span>
<span><span class="va">init_EIR</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="co"># Specify a time step for treatment to begin:</span></span>
<span><span class="va">treatment_start</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">*</span> <span class="fl">365</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Specify a time step  for resistance to emerge:</span></span>
<span><span class="va">resistance_start</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">365</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Load the base malariasimulation parameter set:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span></span>
<span>  overrides <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    human_population <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calibrate to the initial EIR:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams</span>, init_EIR <span class="op">=</span> <span class="va">init_EIR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Append the parameters for artemether lumefantrine (AL) to the parameter list:</span></span>
<span><span class="va">simparams_clin_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_drugs.html">set_drugs</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams</span>, drugs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">AL_params</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the set_clinical_treatment() function to specify a treatment regime for AL:</span></span>
<span><span class="va">simparams_clin_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_clinical_treatment.html">set_clinical_treatment</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams_clin_treatment</span>, </span>
<span>                                                   drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                   timesteps <span class="op">=</span> <span class="va">treatment_start</span>,</span>
<span>                                                   coverages <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the set_antimalarial_resistance() function to specify resistance to AL:</span></span>
<span><span class="va">simparams_resistance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams_clin_treatment</span>,</span>
<span>                                                    drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                    timesteps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">resistance_start</span><span class="op">)</span>,</span>
<span>                                                    artemisinin_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                                                    partner_drug_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                    slow_parasite_clearance_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                    early_treatment_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>                                                    late_clinical_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                    late_parasitological_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                                                    reinfection_during_prophylaxis_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                                                    slow_parasite_clearance_time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<p>We can now use the <code><a href="../reference/run_simulation.html">run_simulation()</a></code> to simulate the
three scenarios for which we have established parameter lists above.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Baseline: No-intervention, no resistance simulation:</span></span>
<span><span class="va">sim_out_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="va">timesteps</span>, parameters <span class="op">=</span> <span class="va">simparams</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clinical treatment with no antimalarial drug resistance:</span></span>
<span><span class="va">sim_out_clin_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="va">timesteps</span>, parameters <span class="op">=</span> <span class="va">simparams_clin_treatment</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clinical treatment with antimalarial drug resistance:</span></span>
<span><span class="va">sim_out_resistance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="va">timesteps</span>, parameters <span class="op">=</span> <span class="va">simparams_resistance</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h3>
<p>With the outputs from the <code><a href="../reference/run_simulation.html">run_simulation()</a></code> function, we
can visualise the effect of resistance on malaria transmission by
plotting the prevalence of malaria in children aged 2-10 years old
(<em>Pf</em>PR<sub>2-10</sub>) over time.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># In each timestep, calculate PfPR_2-10 and add it to as a new column for each simulation output:</span></span>
<span><span class="va">sim_out_baseline</span><span class="op">$</span><span class="va">pfpr210</span> <span class="op">=</span> <span class="va">sim_out_baseline</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">sim_out_baseline</span><span class="op">$</span><span class="va">n_age_730_3650</span></span>
<span><span class="va">sim_out_clin_treatment</span><span class="op">$</span><span class="va">pfpr210</span> <span class="op">=</span> <span class="va">sim_out_clin_treatment</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">sim_out_clin_treatment</span><span class="op">$</span><span class="va">n_age_730_3650</span></span>
<span><span class="va">sim_out_resistance</span><span class="op">$</span><span class="va">pfpr210</span> <span class="op">=</span> <span class="va">sim_out_resistance</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">sim_out_resistance</span><span class="op">$</span><span class="va">n_age_730_3650</span></span>
<span></span>
<span><span class="co"># Plot the prevalence through time in each of the three simulated scenarios:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sim_out_baseline</span><span class="op">$</span><span class="va">timestep</span>, y <span class="op">=</span> <span class="va">sim_out_baseline</span><span class="op">$</span><span class="va">pfpr210</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (days)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a line for the clinical treatment scenario:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sim_out_clin_treatment</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>      y <span class="op">=</span> <span class="va">sim_out_clin_treatment</span><span class="op">$</span><span class="va">pfpr210</span>,</span>
<span>      col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a line for the clinical treatment with resistance scenario:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sim_out_resistance</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>      y <span class="op">=</span> <span class="va">sim_out_resistance</span><span class="op">$</span><span class="va">pfpr210</span>,</span>
<span>      col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add lines to indicate the initiation of treatment and resistance:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">treatment_start</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">resistance_start</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annotate the added vlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment_start</span> <span class="op">+</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">0.9</span>, labels <span class="op">=</span> <span class="st">"Start of\nTreatment"</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resistance_start</span> <span class="op">+</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">0.9</span>, labels <span class="op">=</span> <span class="st">"Start of\nResistance"</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add gridlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, nx <span class="op">=</span> <span class="cn">NULL</span>, ny <span class="op">=</span> <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">0.99</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baseline"</span>, <span class="st">"Treatment"</span>, <span class="st">"Resistance"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">cols</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span>, box.col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="Antimalarial_Resistance_files/figure-html/unnamed-chunk-4-1.png" width="700" style="display: block; margin: auto;"></p>
<p>In the absence of clinical treatment or resistance, prevalence is
comparable between all three scenarios for the first year. Following the
initiation of clinical treatment at the beginning of the second year,
<em>Pf</em>PR<sub>2-10</sub> approximately halves relative to the
no-intervention baseline. However, following the introduction of
artemisinin resistance at the beginning of the third year, early
treatment failure causes the <em>Pf</em>PR<sub>2-10</sub> to increase to
an intermediate level in the resistance scenario.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulating-dynamic-resistance">Simulating dynamic resistance<a class="anchor" aria-label="anchor" href="#simulating-dynamic-resistance"></a>
</h2>
<p>We can also capture scenarios in which resistance to a drug changes
through time. To illustrate, we’ll establish and simulate a scenario in
which resistance to sulfadoxine-pyrimethamine amodiaquine (SP-AQ) is
absent from the population in the first year, but emerges in the third
year and doubles in proportion each year thereafter until 100% of
infections are artemisinin resistant. For simplicity, we’ll assume only
artemisinin resistance is present in the population, and resistance to
artemisinin results only, and always, in early treatment failure.</p>
<div class="section level3">
<h3 id="parameterisation-1">Parameterisation<a class="anchor" aria-label="anchor" href="#parameterisation-1"></a>
</h3>
<p>First, we store in vectors the artemisinin resistance proportions and
the time steps on which they will be updated in the simulation. We also
create a vector of early treatment failure probabilities which, for
simplicity, we assume remain at 1 for each update. Next, we load the
default <code>malariasimulation</code> parameter set, specifying a
larger population size and seasonal transmission, and append the
parameters for SP-AQ (<code>SP_AQ_params</code>) using the
<code><a href="../reference/set_drugs.html">set_drugs()</a></code> function. We’ll specify a simple treatment
regimen using <code><a href="../reference/set_clinical_treatment.html">set_clinical_treatment()</a></code> where, on average,
80% of clinical cases are treated with SP-AQ, beginning after one year.
We then specify a resistance schedule in which artemisinin resistance is
introduced at a proportion of 0.2 after 3 years, and doubles each year
thereafter until all infections are artemisinin resistant. Finally, we
calibrate the human and mosquito population parameters to a defined
entomological inoculation rate (EIR) and are ready to run the
simulation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Specify the time steps over which to simulate:</span></span>
<span><span class="va">timesteps</span> <span class="op">&lt;-</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">8</span></span>
<span></span>
<span><span class="co"># Set an initial EIR value:</span></span>
<span><span class="va">initial_eir</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="co"># Specify the proportion of infections that are artemisinin resistant:</span></span>
<span><span class="va">resistance_updates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify the time steps in which to update the resistance parameters:</span></span>
<span><span class="va">resistance_update_timesteps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fl">365</span>, <span class="fl">6</span><span class="op">*</span><span class="fl">365</span>, by <span class="op">=</span> <span class="fl">365</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify the probability artemisinin resistance infections result in early treatment failure:</span></span>
<span><span class="va">early_treatment_failure_updates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resistance_update_timesteps</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the base malariasimulation parameter set, with seasonal transmission:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span></span>
<span>  overrides <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    human_population <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    model_seasonality <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    g0 <span class="op">=</span>  <span class="fl">0.284596</span>,</span>
<span>    g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.317878</span>,<span class="op">-</span><span class="fl">0.0017527</span>,<span class="fl">0.116455</span><span class="op">)</span>,</span>
<span>    h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.331361</span>,<span class="fl">0.293128</span>,<span class="op">-</span><span class="fl">0.0617547</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Append the parameters for sulfadomamine pyrimethaine (SP-AQ) to the parameter list:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_drugs.html">set_drugs</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams</span>, drugs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">SP_AQ_params</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the set_clinical_treatment() function to specify a treatment regime for SP-AQ:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_clinical_treatment.html">set_clinical_treatment</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams</span>,</span>
<span>                                    drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    timesteps <span class="op">=</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">1</span>,</span>
<span>                                    coverages <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the set_antimalarial_resistance() function to specify resistance to SP-AQ:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams</span>,</span>
<span>                                         drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                         timesteps <span class="op">=</span> <span class="va">resistance_update_timesteps</span>,</span>
<span>                                         artemisinin_resistance_proportion <span class="op">=</span> <span class="va">resistance_updates</span>,</span>
<span>                                         partner_drug_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resistance_update_timesteps</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                         slow_parasite_clearance_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resistance_update_timesteps</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                         early_treatment_failure_probability <span class="op">=</span> <span class="va">early_treatment_failure_updates</span>,</span>
<span>                                         late_clinical_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resistance_update_timesteps</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                         late_parasitological_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resistance_update_timesteps</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                         reinfection_during_prophylaxis_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resistance_update_timesteps</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                         slow_parasite_clearance_time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calibrate the parameters to an initial EIR:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams</span>, init_EIR <span class="op">=</span> <span class="va">initial_eir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-1">Simulation<a class="anchor" aria-label="anchor" href="#simulation-1"></a>
</h3>
<p>We can now use our parameter list to run the simulation using the the
<code><a href="../reference/run_simulation.html">run_simulation()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Run the simulation:</span></span>
<span><span class="va">dynamic_resistance_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="va">timesteps</span>, parameters <span class="op">=</span> <span class="va">simparams</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation-1">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation-1"></a>
</h3>
<p>We can visualise the effect of increasing resistance through time by
plotting the <em>Pf</em>PR<sub>2-10</sub>. We’ve added vertical lines to
indicate when clinical treatment begins, and when the proportion of
infections resistant to artemisinin is updated.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Calculate the prevalence (PfPR210) through time:</span></span>
<span><span class="va">dynamic_resistance_output</span><span class="op">$</span><span class="va">pfpr210</span> <span class="op">&lt;-</span> <span class="va">dynamic_resistance_output</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">dynamic_resistance_output</span><span class="op">$</span><span class="va">n_age_730_3650</span></span>
<span></span>
<span><span class="co"># Open a new plotting window and add a grid:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dynamic_resistance_output</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>     y <span class="op">=</span> <span class="va">dynamic_resistance_output</span><span class="op">$</span><span class="va">pfpr210</span>,</span>
<span>     xaxt <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (years)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify x-axis ticks and labels:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span> <span class="op">*</span> <span class="fl">365</span>, by <span class="op">=</span> <span class="fl">365</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span> <span class="op">*</span> <span class="fl">365</span>, by <span class="op">=</span> <span class="fl">365</span><span class="op">)</span><span class="op">/</span><span class="fl">365</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a line indicating the start of the clinical treatment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">365</span>, lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add lines indicating when resistance is updated:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">resistance_update_timesteps</span>, lty <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a line highlighting the maximum PfPR_2-10 value prior to treatment or resistance:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dynamic_resistance_output</span><span class="op">$</span><span class="va">pfpr210</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add annotations for the vlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">365</span> <span class="op">+</span> <span class="fl">30</span>, y <span class="op">=</span> <span class="fl">0.6</span>, labels <span class="op">=</span> <span class="st">"Clin. treat. begins"</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, srt <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resistance_update_timesteps</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">+</span> <span class="fl">30</span>, y <span class="op">=</span> <span class="fl">0.6</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Art. Res. = "</span>, <span class="va">resistance_updates</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, srt <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<p><img src="Antimalarial_Resistance_files/figure-html/unnamed-chunk-7-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Looking at the figure, we can see that the
<em>Pf</em>PR<sub>2-10</sub> decreases over the two years following the
onset of clinical treatment in the absence of artemisinin resistance.
However, as resistance is introduced and increases through time, the
<em>Pf</em>PR<sub>2-10</sub> increases towards the pre-intervention
seasonal peak as SP-AQ becomes increasingly ineffective in the treatment
of clinical cases of malaria.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulating-antimalarial-resistance-with-multiple-resistance-outcomes">Simulating antimalarial resistance with multiple resistance
outcomes<a class="anchor" aria-label="anchor" href="#simulating-antimalarial-resistance-with-multiple-resistance-outcomes"></a>
</h2>
<p>As we’ve discussed, resistance to an ACT can manifest in multiple
ways. For instance, resistance to the artemisinin component of an ACT
can result in either early treatment failure or slow parasite
clearance.</p>
<p>Using <code>malariasimulation</code>, we can simulate the effects of
multiple potential outcomes of resistance on malaria transmission
dynamics. To illustrate, we’ll parameterise and run a series of
simulations in is i) no clinical treatment, ii) no resistance, iii)
resistance with early treatment failure, iv) resistance with slow
parasite clearance, and v) resistance with early treatment failure and
slow parasite clearance.</p>
<div class="section level3">
<h3 id="parameterisation-2">Parameterisation<a class="anchor" aria-label="anchor" href="#parameterisation-2"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Determine the number of timesteps to run for:</span></span>
<span><span class="va">timesteps</span> <span class="op">&lt;-</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">6</span></span>
<span></span>
<span><span class="co"># Set up a list to store the simulation parameter lists in:</span></span>
<span><span class="va">simulation_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Establish a list of the base parameters with no clinical treatment or antimalarial resistance:</span></span>
<span><span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span>overrides <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>human_population <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">simulation_parameters</span><span class="op">$</span><span class="va">base</span></span>
<span></span>
<span><span class="co"># Establish a parameter list with clinical treatment starting after one year:</span></span>
<span><span class="va">simulation_parameters</span><span class="op">$</span><span class="va">base</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_drugs.html">set_drugs</a></span><span class="op">(</span>drugs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">AL_params</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_clinical_treatment.html">set_clinical_treatment</a></span><span class="op">(</span>drug <span class="op">=</span> <span class="fl">1</span>, timesteps <span class="op">=</span> <span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, coverages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>init_EIR <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">simulation_parameters</span><span class="op">$</span><span class="va">treatment</span></span>
<span></span>
<span><span class="co"># Set the equilibrium for the base parameters:</span></span>
<span><span class="va">simulation_parameters</span><span class="op">$</span><span class="va">base</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>init_EIR <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">simulation_parameters</span><span class="op">$</span><span class="va">base</span></span>
<span></span>
<span><span class="co"># Establish a parameter list with clinical treatment and early treatment failure</span></span>
<span><span class="va">simulation_parameters</span><span class="op">$</span><span class="va">treatment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance</a></span><span class="op">(</span>drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                              timesteps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                              artemisinin_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>                              partner_drug_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              slow_parasite_clearance_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              early_treatment_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>                              late_clinical_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              late_parasitological_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              reinfection_during_prophylaxis_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              slow_parasite_clearance_time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">simulation_parameters</span><span class="op">$</span><span class="va">etf</span></span>
<span></span>
<span><span class="co"># Establish a parameter list with clinical treatment and slow parasite clearance</span></span>
<span><span class="va">simulation_parameters</span><span class="op">$</span><span class="va">treatment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance</a></span><span class="op">(</span>drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                              timesteps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                              artemisinin_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>                              partner_drug_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              slow_parasite_clearance_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>                              early_treatment_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              late_clinical_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              late_parasitological_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              reinfection_during_prophylaxis_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              slow_parasite_clearance_time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">simulation_parameters</span><span class="op">$</span><span class="va">spc</span></span>
<span></span>
<span><span class="co"># Establish a parameter list with clinical treatment, early treatment failure and slow parasite clearance:</span></span>
<span><span class="va">simulation_parameters</span><span class="op">$</span><span class="va">treatment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_antimalarial_resistance.html">set_antimalarial_resistance</a></span><span class="op">(</span>drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                              timesteps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                              artemisinin_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>                              partner_drug_resistance_proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              slow_parasite_clearance_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>                              early_treatment_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>, </span>
<span>                              late_clinical_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              late_parasitological_failure_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              reinfection_during_prophylaxis_probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>                              slow_parasite_clearance_time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">simulation_parameters</span><span class="op">$</span><span class="va">etf_spc</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-2">Simulation<a class="anchor" aria-label="anchor" href="#simulation-2"></a>
</h3>
<p>We can now use our lists of <code>malariasimulation</code> parameters
to run the simulations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Open a list to store the simulation outputs in:</span></span>
<span><span class="va">simulation_outputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the simulations</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">simulation_parameters</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Run the i-th simulation</span></span>
<span>  <span class="va">simulation_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="va">timesteps</span>, </span>
<span>                                    parameters <span class="op">=</span> <span class="va">simulation_parameters</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Append the simulation identifier:</span></span>
<span>  <span class="va">simulation_temp</span><span class="op">$</span><span class="va">identifier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">simulation_parameters</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Append the ith simulation outputs to the combined simulation dataframe:</span></span>
<span>  <span class="va">simulation_outputs</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">simulation_parameters</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">simulation_temp</span></span>
<span>  </span>
<span>  <span class="co"># Print the number of columns in the i-th simulation outputs dataframe:                            </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">simulation_temp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 31</span></span>
<span><span class="co">#&gt; [1] 35</span></span>
<span><span class="co">#&gt; [1] 37</span></span>
<span><span class="co">#&gt; [1] 37</span></span>
<span><span class="co">#&gt; [1] 37</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation-2">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation-2"></a>
</h3>
<p>We can compare the effects of independent resistance outcomes with
combined resistance outcomes visually. In the following plot, we compare
the <em>Pf</em>PR<sub>2-10</sub> between a baseline without any clinical
treatment or antimalarial resistance, a clinical-treatment only run, a
clinical treatment with early treatment failure run, a clinical
treatment with slow parasite clearance run, and a clinical treatment
with both early treatment failure and slow parasite clearance run.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Open a new plotting window and add a grid:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot malaria prevalence in 2-10 years through time:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">base</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>     y <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">base</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">simulation_outputs</span><span class="op">$</span><span class="va">base</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (days)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the dynamics for no-intervention simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">treatment</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>      y <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">treatment</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">simulation_outputs</span><span class="op">$</span><span class="va">treatment</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>      col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">etf</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>      y <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">etf</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">simulation_outputs</span><span class="op">$</span><span class="va">etf</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>      col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">spc</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>      y <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">spc</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">simulation_outputs</span><span class="op">$</span><span class="va">spc</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>      col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">etf_spc</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>      y <span class="op">=</span> <span class="va">simulation_outputs</span><span class="op">$</span><span class="va">etf_spc</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">simulation_outputs</span><span class="op">$</span><span class="va">etf_spc</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>      col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add vlines to indicate when SP-AQ were administered:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">365</span> <span class="op">+</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">40</span>, y <span class="op">=</span> <span class="fl">0.6</span>, labels <span class="op">=</span> <span class="st">"Treatment Introduced"</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, srt <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span> <span class="op">-</span> <span class="fl">40</span>, y <span class="op">=</span> <span class="fl">0.6</span>, labels <span class="op">=</span> <span class="st">"Resistance Introduced"</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, srt <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add gridlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, nx <span class="op">=</span> <span class="cn">NULL</span>, ny <span class="op">=</span> <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3000</span>, y <span class="op">=</span> <span class="fl">0.99</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baseline"</span>, <span class="st">"Treatment"</span>, <span class="st">"ETF-only"</span>, <span class="st">"SPC-only"</span>, <span class="st">"ETF and SPC"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span>, box.col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="Antimalarial_Resistance_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Slater, H.C., Griffin, J.T., Ghani, A.C. and Okell, L.C., 2016.
Assessing the potential impact of artemisinin and partner drug
resistance in sub-Saharan Africa. Malaria journal, 15(1), pp.1-11.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Charles, Peter Winskill, Hillary Topazian, Joseph Challenger, Richard Fitzjohn, Richard Sheppard, Tom Brewer, Kelly McCain, Lydia Haile.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
