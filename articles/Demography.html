<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demography • malariasimulation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Demography">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">malariasimulation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Model.html">Model Introduction</a>
    </li>
    <li>
      <a href="../articles/Demography.html">Demography</a>
    </li>
    <li>
      <a href="../articles/Treatment.html">Treatment</a>
    </li>
    <li>
      <a href="../articles/MDA.html">MDA and Chemoprevention</a>
    </li>
    <li>
      <a href="../articles/Vaccines.html">Vaccines</a>
    </li>
    <li>
      <a href="../articles/VectorControl_Bednets.html">Vector Control: Bednets</a>
    </li>
    <li>
      <a href="../articles/VectorControl_IRS.html">Vector Control: Indoor Residual Spraying</a>
    </li>
    <li>
      <a href="../articles/SetSpecies.html">Mosquito Species</a>
    </li>
    <li>
      <a href="../articles/Carrying-capacity.html">Carrying Capacity</a>
    </li>
    <li>
      <a href="../articles/EIRprevmatch.html">Matching PfPR2-10 to EIR</a>
    </li>
    <li>
      <a href="../articles/Metapopulation.html">Metapopulation Modelling</a>
    </li>
    <li>
      <a href="../articles/Variation.html">Stochastic Variation</a>
    </li>
    <li>
      <a href="../articles/Parameter_variation.html">Parameter Variation</a>
    </li>
    <li>
      <a href="../articles/Plasmodium_vivax.html">Plasmodium Vivax</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/malariasimulation" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Demography</h1>
            
      

      <div class="hidden name"><code>Demography.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the requisite packages:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">malariasimulation</span><span class="op">)</span></span>
<span><span class="co"># Set colour palette:</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#CC79A7"</span>,<span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span><span class="op">)</span></span></code></pre></div>
<p>The dynamics of malaria transmission, and the efficacy of
interventions designed to interrupt it, are highly context specific and
an important consideration is the demography of the population(s) under
investigation. To suit the research needs of the user,
<code>malariasimulation</code> allows for the specification of custom
human population demographics by allowing them to specify age-group
specific death rate parameters. It also enables users to instruct the
model to render outputs with variables of interest (e.g. human
population, number of cases detectable by microscopy, number of severe
cases, etc.) presented by user-defined age groups. In this vignette, we
use simple, illustrative cases to demonstrate how to customise the
output rendered by the <code><a href="../reference/run_simulation.html">run_simulation()</a></code> function, and how
to specify both fixed and time-varying custom death rates.</p>
<div class="section level2">
<h2 id="age-group-rendering">Age group rendering<a class="anchor" aria-label="anchor" href="#age-group-rendering"></a>
</h2>
<p>First, we’ll establish a base set of parameters using the
<code><a href="../reference/get_parameters.html">get_parameters()</a></code> function and accept the default values.
The <code><a href="../reference/run_simulation.html">run_simulation()</a></code> function’s default behaviour is to
output only the number of individuals aged 2-10 years old
(<code>output$n_age_730_3650</code>, where 730 and 3650 are the ages in
days). However, the user can instruct the model to output the number of
individuals in age groups of their choosing using the
<code>age_group_rendering_min_ages</code> and
<code>age_group_rendering_max_ages</code> parameters. These arguments
take vectors containing the minimum and maximum ages (in daily time
steps) of each age group to be rendered. To allow us to see the effect
of changing demographic parameters, we’ll use this functionality to
output the number of individuals in ages groups ranging from 0 to 85 at
5 year intervals. Note that the same is possible for other model outputs
using their equivalent min/max age-class rendering arguments
(<code>n_detect</code> , <code>p_detect</code>, <code>n_severe</code>,
<code>n_inc</code>, <code>p_inc</code>, <code>n_inc_clinical</code>,
<code>p_inc_clinical</code>, <code>n_inc_severe</code>, and
<code>p_inc_severe</code>, run <code>?run_simulation()</code> for more
detail).</p>
<p>We next use the <code><a href="../reference/set_equilibrium.html">set_equilibrium()</a></code> function to tune the
initial parameter set to those required to observe the specified initial
entomological inoculation rate (<code>starting_EIR</code>) at
equilibrium. We now have a set of default parameters ready to use to run
simulations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the timespan over which to simulate</span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">365</span>; <span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">5</span>; <span class="va">sim_length</span> <span class="op">&lt;-</span> <span class="va">year</span> <span class="op">*</span> <span class="va">years</span></span>
<span></span>
<span><span class="co"># Set an initial human population and initial entomological inoculation rate (EIR)</span></span>
<span><span class="va">human_population</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">starting_EIR</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># Set the age ranges (in days)</span></span>
<span><span class="va">age_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span></span>
<span><span class="va">age_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span></span>
<span></span>
<span><span class="co"># Use the get_parameters() function to establish the default simulation parameters, specifying</span></span>
<span><span class="co"># age categories from 0-85 in 5 year intervals.</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    human_population <span class="op">=</span> <span class="va">human_population</span>,</span>
<span>    age_group_rendering_min_ages <span class="op">=</span> <span class="va">age_min</span>,</span>
<span>    age_group_rendering_max_ages <span class="op">=</span> <span class="va">age_max</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use set_equilibrium to tune the human and mosquito populations to those required for the</span></span>
<span><span class="co"># defined EIR</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span><span class="va">simparams</span>, <span class="va">starting_EIR</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="set-custom-demography">Set custom demography<a class="anchor" aria-label="anchor" href="#set-custom-demography"></a>
</h2>
<p>Next, we’ll use the in-built <code><a href="../reference/set_demography.html">set_demography()</a></code> function
to specify human death rates by age group. This function accepts as
inputs a parameter list to update, a vector of the age groups (in days)
for which we specify death rates, a vector of time steps in which we
want the death rates to be updated, and a matrix containing the death
rates for each age group in each timestep. The
<code><a href="../reference/set_demography.html">set_demography()</a></code> function appends these to the parameter
list and updates the <code>custom_demography</code> parameter to
<code>TRUE</code>. Here, we instruct the model to implement these
changes to the demographic parameters at the beginning of the simulation
(<code>timesteps = 0</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Copy the simulation parameters as demography parameters:</span></span>
<span><span class="va">dem_params</span> <span class="op">&lt;-</span> <span class="va">simparams</span></span>
<span></span>
<span><span class="co"># We can set our own custom demography:</span></span>
<span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.083333</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">45</span>,</span>
<span>                <span class="fl">50</span>, <span class="fl">55</span>, <span class="fl">60</span>, <span class="fl">65</span>, <span class="fl">70</span>, <span class="fl">75</span>, <span class="fl">80</span>, <span class="fl">85</span>, <span class="fl">90</span>, <span class="fl">95</span>, <span class="fl">200</span><span class="op">)</span> <span class="op">*</span> <span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set deathrates for each age group (divide annual values by 365:</span></span>
<span><span class="va">deathrates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">.4014834</span>, <span class="fl">.0583379</span>, <span class="fl">.0380348</span>, <span class="fl">.0395061</span>, <span class="fl">.0347255</span>, <span class="fl">.0240849</span>, <span class="fl">.0300902</span>,</span>
<span>  <span class="fl">.0357914</span>, <span class="fl">.0443123</span>, <span class="fl">.0604932</span>, <span class="fl">.0466799</span>, <span class="fl">.0426199</span>, <span class="fl">.0268332</span>, <span class="fl">.049361</span>,</span>
<span>  <span class="fl">.0234852</span>, <span class="fl">.0988317</span>, <span class="fl">.046755</span>, <span class="fl">.1638875</span>, <span class="fl">.1148753</span>, <span class="fl">.3409079</span>, <span class="fl">.2239224</span>,</span>
<span>  <span class="fl">.8338688</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365</span></span>
<span></span>
<span><span class="co"># Update the parameter list with the custom ages and death rates through the in-built</span></span>
<span><span class="co"># set_demography() function, instructing the custom demography to be implemented at the</span></span>
<span><span class="co"># beginning of the model run (timestep = 0):</span></span>
<span><span class="va">dem_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_demography.html">set_demography</a></span><span class="op">(</span></span>
<span>  <span class="va">dem_params</span>,</span>
<span>  agegroups <span class="op">=</span> <span class="va">ages</span>,</span>
<span>  timesteps <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  deathrates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">deathrates</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confirm that the custom demography has been set:</span></span>
<span><span class="va">dem_params</span><span class="op">$</span><span class="va">custom_demography</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<p>Having established parameter sets with both default and custom
demographic parameterisations, we can now run a simulation for each
using the <code><a href="../reference/run_simulation.html">run_simulation()</a></code> function. We’ll also add a
column to each to identify the runs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the simulation with the default demographic set-up:</span></span>
<span><span class="va">exp_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">sim_length</span>, <span class="va">simparams</span><span class="op">)</span></span>
<span><span class="va">exp_output</span><span class="op">$</span><span class="va">run</span> <span class="op">&lt;-</span> <span class="st">'exponential'</span></span>
<span></span>
<span><span class="co"># Run the simulation for the custom demographic set-up:</span></span>
<span><span class="va">custom_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">sim_length</span>, <span class="va">dem_params</span><span class="op">)</span></span>
<span><span class="va">custom_output</span><span class="op">$</span><span class="va">run</span> <span class="op">&lt;-</span> <span class="st">'custom'</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h3>
<p>Using barplots, we can visualise the effect of altering the
demographic parameters by comparing the distribution of people among the
age-classes we instructed the model to output on the final day of the
simulation. The default demography is depicted in blue, while the custom
demography is given in orange. Under the custom demography, the
frequency of individuals in older age classes declines almost linearly,
while in the default demography the number of individuals in each age
class declines exponentially with age.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine the two dataframes:</span></span>
<span><span class="va">dem_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">exp_output</span>, <span class="va">custom_output</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset the final day of the simulation for each of the two demography runs:</span></span>
<span><span class="va">dem_output</span> <span class="op">&lt;-</span> <span class="va">dem_output</span><span class="op">[</span><span class="va">dem_output</span><span class="op">$</span><span class="va">timestep</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">365</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Extract the age variables and convert the dataframe to long format:</span></span>
<span><span class="va">convert_to_long</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age_min</span>, <span class="va">age_max</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">age_min</span><span class="op">)</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        age_lower <span class="op">=</span> <span class="va">age_min</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        age_upper <span class="op">=</span> <span class="va">age_max</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        n <span class="op">=</span> <span class="va">output</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'n_age_'</span>, <span class="va">age_min</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="st">'_'</span>,<span class="va">age_max</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        age_plot <span class="op">=</span> <span class="va">age_min</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">/</span><span class="fl">365</span>,</span>
<span>        run <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">run</span>,</span>
<span>        timestep <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">timestep</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">output</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Convert the output for plotting:</span></span>
<span><span class="va">dem_output</span> <span class="op">&lt;-</span> <span class="fu">convert_to_long</span><span class="op">(</span><span class="va">age_min</span>, <span class="va">age_max</span>, <span class="va">dem_output</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the plotting window</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a) Default/Exponentially-distributed demography</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, ny <span class="op">=</span> <span class="fl">5</span>, nx <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span>height <span class="op">=</span> <span class="va">dem_output</span><span class="op">[</span><span class="va">dem_output</span><span class="op">$</span><span class="va">run</span> <span class="op">==</span> <span class="st">"exponential"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"age_plot"</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">n</span>,</span>
<span>        names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">75</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,<span class="st">"-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">75</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">+</span><span class="fl">4</span><span class="op">)</span>, <span class="st">"80+"</span><span class="op">)</span>,</span>
<span>        axes <span class="op">=</span> <span class="cn">TRUE</span>, space <span class="op">=</span> <span class="fl">0</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">250</span><span class="op">)</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Default"</span>, xlab <span class="op">=</span> <span class="st">"Age Group"</span>, ylab <span class="op">=</span> <span class="st">"Individuals"</span>,</span>
<span>        cex.axis <span class="op">=</span> <span class="fl">0.8</span>, cex.names <span class="op">=</span> <span class="fl">0.8</span>, cex.lab <span class="op">=</span> <span class="fl">1</span>, cex.main <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># b) Custom demography</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, ny <span class="op">=</span> <span class="fl">5</span>, nx <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span>height <span class="op">=</span> <span class="va">dem_output</span><span class="op">[</span><span class="va">dem_output</span><span class="op">$</span><span class="va">run</span> <span class="op">==</span> <span class="st">"custom"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"age_plot"</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">n</span>,</span>
<span>        names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">75</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,<span class="st">"-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">75</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">+</span><span class="fl">4</span><span class="op">)</span>, <span class="st">"80+"</span><span class="op">)</span>,</span>
<span>        axes <span class="op">=</span> <span class="cn">TRUE</span>, space <span class="op">=</span> <span class="fl">0</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">250</span><span class="op">)</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Custom"</span>, xlab <span class="op">=</span> <span class="st">"Age Group"</span>,</span>
<span>        cex.axis <span class="op">=</span> <span class="fl">0.8</span>, cex.names <span class="op">=</span> <span class="fl">0.8</span>, cex.lab <span class="op">=</span> <span class="fl">1</span>, cex.main <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demography_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="set-dynamic-demography">Set dynamic demography<a class="anchor" aria-label="anchor" href="#set-dynamic-demography"></a>
</h2>
<p>Using the <code>timesteps</code> and <code>deathrates</code>
arguments, we can also use the <code><a href="../reference/set_demography.html">set_demography()</a></code> function to
update the death rates of specific age groups through time. In the
following example, we’ll use this functionality to first set our own
initial death rates by age group, then instruct the model to increase
the death rates in the age groups 5-10, 10-15, and 15-20 years old by a
factor of 10 after 2 years. We’ll finish by plotting the number of
individuals in each age class at the end of each year to visualise the
effect of time-varying death rates on the human population
age-structure.</p>
<div class="section level3">
<h3 id="parameterisation">Parameterisation<a class="anchor" aria-label="anchor" href="#parameterisation"></a>
</h3>
<p>We’ll start by making a copy of the base parameters which have been
instructed to output the population size through time
(<code>simparams</code>). Next, we create a version of the
<code>deathrates</code> vector created earlier updated to increase the
death rates of the 5-10, 10-15, and 15-20 age groups by 10%. Finally, we
use <code><a href="../reference/set_demography.html">set_demography()</a></code> to update our parameter list and
specify our custom demography. This is achieved providing the
<code>timesteps</code> argument with a vector of days to update the
death rates (0 and 730 days), and providing <code>deathrates</code> with
a matrix of death rates where each row corresponds to a set of death
rates for a given update.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store the simulation parameters in a new object for modification</span></span>
<span><span class="va">dyn_dem_params</span> <span class="op">&lt;-</span> <span class="va">simparams</span></span>
<span></span>
<span><span class="co"># Increase the death rates in some age groups (5-15 year olds):</span></span>
<span><span class="va">deathrates_increased</span> <span class="op">&lt;-</span> <span class="va">deathrates</span></span>
<span><span class="va">deathrates_increased</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">deathrates_increased</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">*</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Set the population demography using these updated deathrates</span></span>
<span><span class="va">dyn_dem_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_demography.html">set_demography</a></span><span class="op">(</span></span>
<span>  <span class="va">dyn_dem_params</span>,</span>
<span>  agegroups <span class="op">=</span> <span class="va">ages</span>,</span>
<span>  timesteps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="fl">365</span><span class="op">)</span>,</span>
<span>  deathrates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">deathrates</span>, <span class="va">deathrates_increased</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-1">Simulation<a class="anchor" aria-label="anchor" href="#simulation-1"></a>
</h3>
<p>Having established the parameter list for the dynamic death rate
simulation, we can now run the simulation using the
<code><a href="../reference/run_simulation.html">run_simulation()</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the simulation for the dynamic death rate demography</span></span>
<span><span class="va">dyn_dem_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">sim_length</span>, <span class="va">dyn_dem_params</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation-1">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation-1"></a>
</h3>
<p>Bar plots of the age structure of the human population at the end of
each year show the marked effect that increasing the death rate within a
small subset of age classes can have on the demography of the human
population over time.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter out the end-of-year population sizes, add a column naming the run, and convert</span></span>
<span><span class="co"># dataframe to long-form:</span></span>
<span><span class="va">dyn_dem_output</span> <span class="op">&lt;-</span> <span class="va">dyn_dem_output</span><span class="op">[</span><span class="va">dyn_dem_output</span><span class="op">$</span><span class="va">timestep</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">dyn_dem_output</span><span class="op">$</span><span class="va">run</span> <span class="op">&lt;-</span> <span class="st">'dynamic'</span></span>
<span><span class="va">dyn_dem_output</span> <span class="op">&lt;-</span> <span class="fu">convert_to_long</span><span class="op">(</span><span class="va">age_min</span>, <span class="va">age_max</span>, <span class="va">dyn_dem_output</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set a 1x5 plotting window:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through the years to plot:</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, ny <span class="op">=</span> <span class="fl">5</span>, nx <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span>height <span class="op">=</span> <span class="va">dyn_dem_output</span><span class="op">[</span><span class="va">dyn_dem_output</span><span class="op">$</span><span class="va">timestep</span><span class="op">/</span><span class="fl">365</span> <span class="op">==</span> <span class="va">i</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"age_plot"</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">n</span>,</span>
<span>          names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">75</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,<span class="st">"-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">75</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">+</span><span class="fl">4</span><span class="op">)</span>, <span class="st">"80+"</span><span class="op">)</span>,</span>
<span>          axes <span class="op">=</span> <span class="cn">TRUE</span>, space <span class="op">=</span> <span class="fl">0</span>,</span>
<span>          ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>          main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Year "</span>, <span class="va">i</span><span class="op">)</span>, cex.main <span class="op">=</span> <span class="fl">1.4</span>,</span>
<span>          xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">3</span>, <span class="st">"Age Group"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>          ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Individuals"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>          xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>, las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          cex.axis <span class="op">=</span> <span class="fl">0.8</span>, cex.names <span class="op">=</span> <span class="fl">0.8</span>, cex.lab <span class="op">=</span> <span class="fl">1</span>, cex.main <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Demography_files/figure-html/unnamed-chunk-8-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Charles, Peter Winskill, Hillary Topazian, Joseph Challenger, Richard Fitzjohn, Richard Sheppard, Tom Brewer, Kelly McCain, Lydia Haile.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
