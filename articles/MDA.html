<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mass Drug Administriation and Chemoprevention • malariasimulation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mass Drug Administriation and Chemoprevention">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">malariasimulation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Model.html">Model Introduction</a>
    </li>
    <li>
      <a href="../articles/Demography.html">Demography</a>
    </li>
    <li>
      <a href="../articles/Treatment.html">Treatment</a>
    </li>
    <li>
      <a href="../articles/MDA.html">MDA and Chemoprevention</a>
    </li>
    <li>
      <a href="../articles/Vaccines.html">Vaccines</a>
    </li>
    <li>
      <a href="../articles/VectorControl_Bednets.html">Vector Control: Bednets</a>
    </li>
    <li>
      <a href="../articles/VectorControl_IRS.html">Vector Control: Indoor Residual Spraying</a>
    </li>
    <li>
      <a href="../articles/SetSpecies.html">Mosquito Species</a>
    </li>
    <li>
      <a href="../articles/Carrying-capacity.html">Carrying Capacity</a>
    </li>
    <li>
      <a href="../articles/EIRprevmatch.html">Matching PfPR2-10 to EIR</a>
    </li>
    <li>
      <a href="../articles/Metapopulation.html">Metapopulation Modelling</a>
    </li>
    <li>
      <a href="../articles/Variation.html">Stochastic Variation</a>
    </li>
    <li>
      <a href="../articles/Parameter_variation.html">Parameter Variation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/malariasimulation" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mass Drug Administriation and
Chemoprevention</h1>
            
      

      <div class="hidden name"><code>MDA.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the requisite packages:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">malariasimulation</span><span class="op">)</span></span>
<span><span class="co"># Set colour palette:</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#CC79A7"</span>,<span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span><span class="op">)</span></span></code></pre></div>
<p>Malaria chemoprevention encompasses a suite of strategies for
reducing malaria morbidity, mortality, and transmission through the
treatment of at-risk populations with antimalarial drugs. Three such
strategies are mass drug administration (MDA), seasonal malaria
chemoprevention (SMC), and perennial malaria chemoprevention (PMC). MDA
attempts to simultaneously treat an entire population, irrespective of
their infection risk or status. SMC targets children aged 3-59 months
with a course of an antimalarial through the peak malaria transmission
season. PMC is designed for settings with perennially high transmission
and seeks to administer a full antimalarial course at defined intervals
irrespective of age or disease status.</p>
<p><code>malariasimulation</code> enables users to simulate the effects
of chemoprevention strategies on malaria transmission, and provides the
flexibility to design and simulate a range of MDA/SMC/PMC campaigns for
a suite of antimalarial drugs. Specifically, users are able to load or
specify parameters describing both the characteristics of the
antimalarial(s) (e.g. drug efficacy, prophylactic profile) and their
distribution (e.g. coverage, distribution timing, and the section of the
population to treat). This vignette provides simple, illustrative
demonstrations of how MDA and SMC campaigns can be set-up and simulated
using <code>malariasimulation</code>. The functionality to simulate PMC
campaigns is also built into <code>malariasimulation</code> via the
<code><a href="../reference/set_pmc.html">set_pmc()</a></code> function, but we do not demonstrate the use of
PMC in this vignette (for further information on their use, see <a href="https://mrc-ide.github.io/malariasimulation/reference/set_pmc.html" class="external-link">set_pmc</a>).</p>
<div class="section level2">
<h2 id="mass-drug-administration">Mass Drug Administration<a class="anchor" aria-label="anchor" href="#mass-drug-administration"></a>
</h2>
<p>To illustrate how MDA can be simulated using
<code>malariasimulation</code>, we will implement a campaign that
distributes a single dose of sulphadoxine-pyrimethamine amodiaquine
(SP-AQ) to 80% of the entire population once a year over a two year
period, initiated at the end of the first year.</p>
<div class="section level3">
<h3 id="parameterisation">Parameterisation<a class="anchor" aria-label="anchor" href="#parameterisation"></a>
</h3>
<p>The first step is to generate the list of
<code>malariasimulation</code> parameters using the
<code><a href="../reference/get_parameters.html">get_parameters()</a></code> function. Here, we’ll use the default
<code>malariasimulation</code> parameter set (run
<code>?get_parameters()</code> to view), but specify the seasonality
parameters to simulate a highly seasonal, unimodal rainfall pattern
(illustrated in the plot of total adult female mosquito population
dynamics below). To do this, we set <code>model_seasonality</code> to
<code>TRUE</code> within <code><a href="../reference/get_parameters.html">get_parameters()</a></code>, and then tune
the rainfall pattern using the <code>g0</code>, <code>g</code>, and
<code>h</code> parameters (which represent fourier coefficients). In the
<code>malariasimulation</code> model, rainfall governs the time-varying
mosquito population carrying capacity through density-dependent
regulation of the larval population and, therefore, annual patterns of
malaria transmission. Next, we use the <code><a href="../reference/set_equilibrium.html">set_equilibrium()</a></code>
function to tune the initial human and mosquito populations to those
required to observe the specified initial EIR.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Establish the length of time, in daily time steps, over which to simulate:</span></span>
<span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fl">365</span>; <span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">sim_length</span> <span class="op">&lt;-</span> <span class="va">years</span> <span class="op">*</span> <span class="va">year</span></span>
<span></span>
<span><span class="co"># Set the size of the human population and an initial entomological inoculation rate (EIR)</span></span>
<span><span class="va">human_population</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">starting_EIR</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co"># Use the simparams() function to build the list of simulation parameters and then specify</span></span>
<span><span class="co"># a seasonal profile with a single peak using the g0, g, and h parameters.</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    human_population <span class="op">=</span> <span class="va">human_population</span>,</span>
<span>    model_seasonality <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    g0 <span class="op">=</span> <span class="fl">0.284596</span>,</span>
<span>    g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.317878</span>,<span class="op">-</span><span class="fl">0.0017527</span>,<span class="fl">0.116455</span><span class="op">)</span>,</span>
<span>    h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.331361</span>,<span class="fl">0.293128</span>,<span class="op">-</span><span class="fl">0.0617547</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the set_equilibrium() function to update the individual-based model parameters to those </span></span>
<span><span class="co"># required to match the specified initial EIR (starting_EIR) at equilibrium:</span></span>
<span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span><span class="va">simparams</span>, <span class="va">starting_EIR</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interventions">Interventions<a class="anchor" aria-label="anchor" href="#interventions"></a>
</h3>
<p>Having established a base set of parameters (<code>simparams</code>),
the next step is to add the parameters specifying the MDA campaign. We
first use the <code><a href="../reference/set_drugs.html">set_drugs()</a></code> function to update the parameter
list (<code>simparams</code>) with the parameter values for the drug(s)
we wish to simulate, in this case using the in-built parameter set for
SP-AQ (<code>SP_AQ_params</code>). Note that the
<code>malariasimulation</code> package also contains in-built parameter
sets for dihydroartemisinin-piperaquine (<code>DHA_PQP_params</code>)
and artemether lumefantrine (<code>AL_params</code>), and users can also
define their own drug parameters.</p>
<p>We then define the time steps on which we want the MDA to occur
(stored here in the vector <code>mda_events</code> for legibility), and
use the <code><a href="../reference/set_mda.html">set_mda()</a></code> function to update the parameter list
with our MDA campaign parameters. <code><a href="../reference/set_mda.html">set_mda()</a></code> takes as its
first two arguments the base parameter list and the time steps on which
to schedule MDA events. This function also requires the user to specify
the proportion of the population they want to treat using
<code>coverages</code>, as well as the age-range of the population we
want to treat using <code>min_ages</code> and <code>max_ages</code>,
<em>for each timestep on which MDA is scheduled</em>. Note that this
enables users to specify individual events to have different drug,
coverage, and human-target properties. The <code>drug</code> argument
refers to the index of the drug we want to distribute in the MDA in the
list of parameters (in this demonstration we have only added a single
drug, SP-AQ, using <code><a href="../reference/set_drugs.html">set_drugs()</a></code>, but we could have specified
additional drugs).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a copy of the base simulation parameters to which we can add the MDA campaign parameters:</span></span>
<span><span class="va">mdaparams</span> <span class="op">&lt;-</span> <span class="va">simparams</span></span>
<span></span>
<span><span class="co"># Update the parameter list with the default parameters for sulphadoxine-pyrimethamine</span></span>
<span><span class="co"># amodiaquine (SP-AQ)</span></span>
<span><span class="va">mdaparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_drugs.html">set_drugs</a></span><span class="op">(</span><span class="va">mdaparams</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">SP_AQ_params</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify the days on which to administer the SP-AQ</span></span>
<span><span class="va">mda_events</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use set_mda() function to set the proportion of the population that the MDA reaches and the age </span></span>
<span><span class="co"># ranges which can receive treatment.</span></span>
<span><span class="va">mdaparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_mda.html">set_mda</a></span><span class="op">(</span><span class="va">mdaparams</span>,</span>
<span>                     drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     timesteps <span class="op">=</span> <span class="va">mda_events</span>,</span>
<span>                     coverages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                     min_ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mda_events</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     max_ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">200</span> <span class="op">*</span> <span class="fl">365</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mda_events</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Having generated a base, no-intervention parameter set
(<code>simparams</code>) and a version updated to define an MDA campaign
(<code>mdaparams</code>), we can now use the
<code><a href="../reference/run_simulation.html">run_simulation()</a></code> function to run simulations for scenarios
without interventions and with our MDA campaign.</p>
</div>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the simulation in the absence of any interventions:</span></span>
<span><span class="va">noint_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">sim_length</span>, <span class="va">simparams</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the simulation with the prescribed MDA campaign</span></span>
<span><span class="va">mda_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">sim_length</span>, <span class="va">mdaparams</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h3>
<p>The <code><a href="../reference/run_simulation.html">run_simulation()</a></code> function returns a dataframe
containing time series for a range of variables, including the number of
human individuals in each infectious state, and the number of people and
detected cases in children aged 2-10. The plots below illustrate how the
effect of an MDA campaign on the malaria transmission dynamics can be
visualised. The first presents the distribution of people among the
infectious states in the MDA simulation. The second compares the
prevalence of malaria in children aged 2-10 years old
(<em>Pf</em>PR<sub>2-10</sub>) between the no-intervention and MDA
scenarios simulated.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store the state names, and labels and colours with which to plot them:</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_Count"</span>, <span class="st">"D_count"</span>, <span class="st">"Tr_count"</span>, <span class="st">"A_count"</span>, <span class="st">"U_count"</span><span class="op">)</span></span>
<span><span class="va">state_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"D"</span>, <span class="st">"Tr"</span>, <span class="st">"A"</span>, <span class="st">"U"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open a new plotting window:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the time series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mda_output</span><span class="op">$</span><span class="va">timestep</span>, y <span class="op">=</span> <span class="va">mda_output</span><span class="op">$</span><span class="va">S_count</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">950</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"Individuals"</span>, xlab <span class="op">=</span> <span class="st">"Time (days)"</span>,</span>
<span>     xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay the time-series for other states</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mda_output</span><span class="op">[</span>,<span class="va">states</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Add vlines to show when SP-AQ was administered:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">mda_events</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mda_events</span><span class="op">+</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fl">900</span>, labels <span class="op">=</span> <span class="st">"MDA int."</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add gridlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, nx <span class="op">=</span> <span class="cn">NULL</span>, ny <span class="op">=</span> <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">state_labels</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, box.col <span class="op">=</span> <span class="st">"white"</span>, ncol <span class="op">=</span> <span class="fl">2</span>, x.intersp <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="MDA_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open a new plotting window and add a grid:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, new <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot malaria prevalence in 2-10 years through time:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mda_output</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>     y <span class="op">=</span> <span class="va">mda_output</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">mda_output</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (days)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the dynamics for no-intervention simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">noint_output</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>     y <span class="op">=</span> <span class="va">noint_output</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">noint_output</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add vlines to indicate when SP-AQ were administered:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">mda_events</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mda_events</span><span class="op">+</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fl">0.95</span>, labels <span class="op">=</span> <span class="st">"MDA int."</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add gridlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, nx <span class="op">=</span> <span class="cn">NULL</span>, ny <span class="op">=</span> <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">0.99</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MDA"</span>, <span class="st">"No-Int"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, box.col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="MDA_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="seasonal-malaria-chemoprevention">Seasonal Malaria Chemoprevention<a class="anchor" aria-label="anchor" href="#seasonal-malaria-chemoprevention"></a>
</h2>
<p>To demonstrate how to simulate SMC in <code>malariasimulation</code>
, in the following section we’ll set-up and simulate a campaign that
treats 90% of children aged 3-59 months old with four doses of SP-AQ per
year. We will set the SMC campaign to begin in the second year, run for
two years, and specify the four SMC events to occur at monthly
intervals, starting two months prior to the peak malaria season.</p>
<div class="section level3">
<h3 id="interventions-1">Interventions<a class="anchor" aria-label="anchor" href="#interventions-1"></a>
</h3>
<p>While the first step would typically be to establish the base set of
parameters, we can use those stored earlier in <code>simparams</code>.
We first store a copy of these base parameters and then use
<code><a href="../reference/set_drugs.html">set_drugs()</a></code> to store the preset parameters for SP-AQ in the
parameter list. As SMC is conducted during the peak malaria season, we
need to use the <code><a href="../reference/peak_season_offset.html">peak_season_offset()</a></code> function to determine
when the peak malaria season occurs given our specified seasonal
profile. This function reads in the parameter list, uses
<code>g0</code>, <code>g</code>, <code>h</code>, and
<code>rainfall_floor</code> to generate the rainfall profile for a
single year, and returns the day on which the maximum rainfall value
occurs. We can then take this calculated seasonal peak and time SMC
events around it. Here, we’ve specified four monthly drug administration
days per year starting two months before the seasonal peak. To
illustrate this, we can plot the total adult mosquito population size
through time which, in the absence of interventions targeting
mosquitoes, will closely match the rainfall pattern, and overlay both
the annual seasonal peak and planned SMC events. Once we’re happy with
our SMC campaign, we use the <code><a href="../reference/set_smc.html">set_smc()</a></code> function to update
the parameter list with our <code>drug</code>, <code>timesteps</code>,
<code>coverages</code> and target age group (<code>min_ages</code> and
<code>max_ages</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Copy the original simulation parameters</span></span>
<span><span class="va">smcparams</span> <span class="op">&lt;-</span> <span class="va">simparams</span></span>
<span></span>
<span><span class="co"># Append the parameters for SP-AQ using set_drugs</span></span>
<span><span class="va">smcparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_drugs.html">set_drugs</a></span><span class="op">(</span><span class="va">smcparams</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">SP_AQ_params</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the peak_season_offset() to calculate the yearly offset (in daily timesteps) for the peak mosq.</span></span>
<span><span class="co"># season</span></span>
<span><span class="va">peak</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/peak_season_offset.html">peak_season_offset</a></span><span class="op">(</span><span class="va">smcparams</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a variable for total mosquito population through time:</span></span>
<span><span class="va">noint_output</span><span class="op">$</span><span class="va">mosq_total</span> <span class="op">=</span> <span class="va">noint_output</span><span class="op">$</span><span class="va">Sm_gamb_count</span> <span class="op">+</span></span>
<span>  <span class="va">noint_output</span><span class="op">$</span><span class="va">Im_gamb_count</span> <span class="op">+</span></span>
<span>  <span class="va">noint_output</span><span class="op">$</span><span class="va">Pm_gamb_count</span></span>
<span></span>
<span><span class="co"># Schedule drug administration times (in daily time steps) before, during and after the seasonal peak:</span></span>
<span><span class="va">admin_days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">60</span>, <span class="op">-</span><span class="fl">30</span>, <span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use the peak-offset, number of simulation years and number of drug admin. days to calculate the days</span></span>
<span><span class="co"># on which to administer drugs in each year</span></span>
<span><span class="va">smc_days</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">years</span><span class="op">-</span><span class="fl">1</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">admin_days</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">peak</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">admin_days</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Turn off scientific notation for the plot:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">666</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open a new plotting window,set the margins and plot the total adult female mosquito population</span></span>
<span><span class="co"># through time:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">noint_output</span><span class="op">$</span><span class="va">timestep</span>, <span class="va">noint_output</span><span class="op">$</span><span class="va">mosq_total</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (days)"</span>, ylab <span class="op">=</span> <span class="st">"Adult Female Mosquitos"</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">noint_output</span><span class="op">$</span><span class="va">mosq_total</span><span class="op">)</span><span class="op">*</span><span class="fl">1.1</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>     xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add gridlines</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, nx <span class="op">=</span> <span class="fl">11</span>, ny <span class="op">=</span> <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/box.html" class="external-link">box</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay the SMC days and the calculated seasonal peak</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">smc_days</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">+</span> <span class="va">peak</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"M"</span><span class="op">[</span><span class="st">"Tot"</span><span class="op">]</span><span class="op">)</span>, <span class="st">"SMC"</span>, <span class="st">"Peak"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="st">"black"</span>, <span class="va">cols</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, box.col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></code></pre></div>
<p><img src="MDA_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Update the SMC parameters list:</span></span>
<span><span class="va">smcparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_smc.html">set_smc</a></span><span class="op">(</span></span>
<span>  <span class="va">smcparams</span>,</span>
<span>  drug <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  timesteps <span class="op">=</span> <span class="va">smc_days</span>,</span>
<span>  coverages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">smc_days</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  min_ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">smc_days</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  max_ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">59</span> <span class="op">*</span> <span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">smc_days</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulations">Simulations<a class="anchor" aria-label="anchor" href="#simulations"></a>
</h3>
<p>Having generated our SMC parameter list, we can run the simulation
using the <code><a href="../reference/run_simulation.html">run_simulation()</a></code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the SMC simulation</span></span>
<span><span class="va">smc_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">sim_length</span>, <span class="va">smcparams</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualisation-1">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation-1"></a>
</h3>
<p>We can now plot the simulation output to visualise the effect of our
SMC campaign on malaria transmission dynamics, again focusing on the
distribution of people in each of the infectious states and on malaria
prevalence in children aged 2-10 (<em>Pf</em>PR<sub>2-10</sub>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open a new plotting window and add a grid:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the time series of human infectious states through time under the SMC campaign</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">smc_output</span><span class="op">$</span><span class="va">timestep</span>, y <span class="op">=</span> <span class="va">smc_output</span><span class="op">$</span><span class="va">S_count</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">950</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">"Individuals"</span>, xlab <span class="op">=</span> <span class="st">"Time (days)"</span>,</span>
<span>     xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay the time-series for other human infection states</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">smc_output</span><span class="op">[</span>,<span class="va">states</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Add vlines to indicate when SMC drugs were administered:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">smc_days</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">smc_days</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">8</span><span class="op">)</span><span class="op">]</span><span class="op">+</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fl">900</span>, labels <span class="op">=</span> <span class="st">"SMC\nint."</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add gridlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, nx <span class="op">=</span> <span class="cn">NULL</span>, ny <span class="op">=</span> <span class="cn">NULL</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">state_labels</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       box.col <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, ncol <span class="op">=</span> <span class="fl">2</span>, x.intersp <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> </span></code></pre></div>
<p><img src="MDA_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open a new plotting window and add a grid:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new <span class="op">=</span> <span class="cn">TRUE</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot malaria prevalence in 2-10 years through time:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">smc_output</span><span class="op">$</span><span class="va">timestep</span>, y <span class="op">=</span> <span class="va">smc_output</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">smc_output</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time (days)"</span>, </span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the dynamics for no-intervention simulation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">noint_output</span><span class="op">$</span><span class="va">timestep</span>,</span>
<span>     y <span class="op">=</span> <span class="va">noint_output</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span><span class="op">/</span><span class="va">noint_output</span><span class="op">$</span><span class="va">n_age_730_3650</span>,</span>
<span>     col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add lines to indicate SMC events:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">smc_days</span>, lty <span class="op">=</span> <span class="st">"dashed"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">smc_days</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">8</span><span class="op">)</span><span class="op">]</span><span class="op">+</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fl">0.95</span>, labels <span class="op">=</span> <span class="st">"SMC\nint."</span>, adj <span class="op">=</span> <span class="fl">0</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add gridlines:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, nx <span class="op">=</span> <span class="fl">11</span>, ny <span class="op">=</span> <span class="fl">10</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SMC"</span>, <span class="st">"No-Int"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, box.col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="MDA_files/figure-html/unnamed-chunk-10-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Charles, Peter Winskill, Hillary Topazian, Joseph Challenger, Richard Fitzjohn, Richard Sheppard, Tom Brewer, Kelly McCain, Lydia Haile.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
