<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stochastic Variation â€¢ malariasimulation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Stochastic Variation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">malariasimulation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Model.html">Model Introduction</a>
    </li>
    <li>
      <a href="../articles/Demography.html">Demography</a>
    </li>
    <li>
      <a href="../articles/Treatment.html">Treatment</a>
    </li>
    <li>
      <a href="../articles/MDA.html">MDA and Chemoprevention</a>
    </li>
    <li>
      <a href="../articles/Vaccines.html">Vaccines</a>
    </li>
    <li>
      <a href="../articles/VectorControl_Bednets.html">Vector Control: Bednets</a>
    </li>
    <li>
      <a href="../articles/VectorControl_IRS.html">Vector Control: Indoor Residual Spraying</a>
    </li>
    <li>
      <a href="../articles/SetSpecies.html">Mosquito Species</a>
    </li>
    <li>
      <a href="../articles/Carrying-capacity.html">Carrying Capacity</a>
    </li>
    <li>
      <a href="../articles/EIRprevmatch.html">Matching PfPR2-10 to EIR</a>
    </li>
    <li>
      <a href="../articles/Metapopulation.html">Metapopulation Modelling</a>
    </li>
    <li>
      <a href="../articles/Variation.html">Stochastic Variation</a>
    </li>
    <li>
      <a href="../articles/Parameter_variation.html">Parameter Variation</a>
    </li>
    <li>
      <a href="../articles/Plasmodium_vivax.html">Plasmodium Vivax</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/malariasimulation" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Stochastic Variation</h1>
            
      

      <div class="hidden name"><code>Variation.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the requisite packages:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">malariasimulation</span><span class="op">)</span></span>
<span><span class="co"># Set colour palette:</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">555</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"#&gt;"</span>,</span>
<span>  dpi<span class="op">=</span><span class="fl">300</span>,</span>
<span>  fig.width<span class="op">=</span><span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>malariasimulation</code> is a stochastic, individual-based
model and, as such, simulations run with identical parameterisations
will generate non-identical, sometimes highly variable, outputs. To
illustrate this, we will compare the prevalence and incidence of malaria
over a year in simulations with a small and a larger population. Then we
will demonstrate how this variation can be estimated by running multiple
simulations using the <code>run_simulation_with_repetitions</code>
function.</p>
<p>First, we will create a few plotting functions to visualise
outputs.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_prev</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">output</span>, <span class="va">ylab</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">ylim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">ylab</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ylab</span> <span class="op">=</span> <span class="st">"Prevalence in children aged 2-10 years"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="va">ylab</span> <span class="op">=</span> <span class="st">""</span><span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">timestep</span>, y <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span> <span class="op">/</span> <span class="va">output</span><span class="op">$</span><span class="va">n_age_730_3650</span>, </span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="va">ylim</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"Time (days)"</span>, ylab <span class="op">=</span> <span class="va">ylab</span>, lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_inci</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">output</span>, <span class="va">ylab</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">ylim</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">ylab</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ylab</span> <span class="op">=</span> <span class="st">"Incidence per 1000 children aged 0-5 years"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="va">ylab</span> <span class="op">=</span> <span class="st">""</span><span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">timestep</span>, y <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">n_inc_clinical_0_1825</span> <span class="op">/</span> <span class="va">output</span><span class="op">$</span><span class="va">n_age_0_1825</span> <span class="op">*</span> <span class="fl">1000</span>, </span>
<span>       type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, ylim <span class="op">=</span> <span class="va">ylim</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"Time (days)"</span>, ylab <span class="op">=</span> <span class="va">ylab</span>, lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aggregate_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span><span class="op">$</span><span class="va">n_detect_lm_730_3650</span>,</span>
<span>    by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">timestep</span><span class="op">)</span>,</span>
<span>    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        lowq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        highq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        lowci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        highci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">Group.1</span>, <span class="va">tmp</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_variation_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">title_str</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"n"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>       ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">14</span><span class="op">)</span>,</span>
<span>       xaxs <span class="op">=</span> <span class="st">"i"</span>, yaxs <span class="op">=</span> <span class="st">"i"</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">'timestep'</span>, ylab <span class="op">=</span><span class="st">'Light miscroscopy detectable infections'</span>, main <span class="op">=</span> <span class="va">title_str</span>,</span>
<span>       font.main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">highci</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lowci</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, border <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">highq</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lowq</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, border <span class="op">=</span> <span class="va">cols</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">t</span>, y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">median</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">40</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="variation-and-population-size">Variation and population size<a class="anchor" aria-label="anchor" href="#variation-and-population-size"></a>
</h2>
<div class="section level3">
<h3 id="parameterisation">Parameterisation<a class="anchor" aria-label="anchor" href="#parameterisation"></a>
</h3>
<p>We will use the <code><a href="../reference/get_parameters.html">get_parameters()</a></code> function to generate a
list of parameters, accepting the default values, for two different
population sizes and use the <code><a href="../reference/set_equilibrium.html">set_equilibrium()</a></code> function to
initialise the model at a given entomological inoculation rate (EIR).
The only parameter which changes between the two parameter sets is the
argument for <code>human_population</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A small population </span></span>
<span><span class="va">simparams_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  human_population <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  clinical_incidence_rendering_min_ages <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  clinical_incidence_rendering_max_ages <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">365</span>,</span>
<span>  individual_mosquitoes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simparams_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams_small</span>, init_EIR <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A larger population </span></span>
<span><span class="va">simparams_big</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  human_population <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  clinical_incidence_rendering_min_ages <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  clinical_incidence_rendering_max_ages <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">365</span>,</span>
<span>  individual_mosquitoes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simparams_big</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams_big</span>, init_EIR <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulations">Simulations<a class="anchor" aria-label="anchor" href="#simulations"></a>
</h3>
<p>The <code>n_detect_lm_730_3650</code> output below shows the total
number of individuals in the age group rendered (here, 730-3650
timesteps or 2-10 years) who have microscopy-detectable malaria. Notice
that the output is smoother at a higher population.</p>
<p>Some outcomes will be more sensitive than others to stochastic
variation even with the same population size. In the plots below,
prevalence is smoother than incidence even at the same population. This
is because prevalence is a measure of existing infection, while
incidence is recording new cases per timestep.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A small population</span></span>
<span><span class="va">output_small_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">365</span>, parameters <span class="op">=</span> <span class="va">simparams_small</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A larger population</span></span>
<span><span class="va">output_big_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">365</span>, parameters <span class="op">=</span> <span class="va">simparams_big</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_prev</span><span class="op">(</span><span class="va">output_small_pop</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span>, <span class="st">" at n = 1,000"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_inci</span><span class="op">(</span><span class="va">output_small_pop</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Incidence per 1000 children at n = 1,000"</span>, cex.main <span class="op">=</span> <span class="fl">1</span>, font.main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">plot_prev</span><span class="op">(</span><span class="va">output_big_pop</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span>, <span class="st">" at n = 10,000"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_inci</span><span class="op">(</span><span class="va">output_big_pop</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Incidence per 1000 children at n = 10,000"</span>, cex.main <span class="op">=</span> <span class="fl">1</span>, font.main <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Variation_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="stochastic-elimination">Stochastic elimination<a class="anchor" aria-label="anchor" href="#stochastic-elimination"></a>
</h2>
<p>With stochastic models, random elimination of malaria in a small
population with low transmisison may happen. In the example below, we
run two simulations: one with a very small population, and one with a
larger population. There is stochastic fade out (elimination) in the
smaller population, while the larger population has stable transmission
over time. For this reason, it is important to run models with
large-enough populations to avoid stochastic elimination.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A small population </span></span>
<span><span class="va">simparams_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  human_population <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  clinical_incidence_rendering_min_ages <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  clinical_incidence_rendering_max_ages <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">365</span>,</span>
<span>  individual_mosquitoes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simparams_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams_small</span>, init_EIR <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A larger population </span></span>
<span><span class="va">simparams_big</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  human_population <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  clinical_incidence_rendering_min_ages <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  clinical_incidence_rendering_max_ages <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">365</span>,</span>
<span>  individual_mosquitoes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simparams_big</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">simparams_big</span>, init_EIR <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="simulations-1">Simulations<a class="anchor" aria-label="anchor" href="#simulations-1"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">444</span><span class="op">)</span></span>
<span><span class="co"># A small population</span></span>
<span><span class="va">output_small_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">2</span>, parameters <span class="op">=</span> <span class="va">simparams_small</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A larger population</span></span>
<span><span class="va">output_big_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">2</span>, parameters <span class="op">=</span> <span class="va">simparams_big</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_prev</span><span class="op">(</span><span class="va">output_small_pop</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span>, <span class="st">" at n = 50"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_prev</span><span class="op">(</span><span class="va">output_big_pop</span>, ylab <span class="op">=</span> <span class="cn">FALSE</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">Pf</span><span class="op">)</span>,<span class="st">"PR"</span><span class="op">[</span><span class="fl">2</span><span class="op">-</span><span class="fl">10</span><span class="op">]</span>, <span class="st">" at n = 1,000"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Variation_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="estimating-variation">Estimating variation<a class="anchor" aria-label="anchor" href="#estimating-variation"></a>
</h2>
<p>We can estimate the variation in the number of detectable cases by
repeating the simulation several times using the
<code><a href="../reference/run_simulation_with_repetitions.html">run_simulation_with_repetitions()</a></code> function. The functions
requires arguments for <code>repetitions</code> (the number of repeat
simulations) and the option of whether to run simulations in parallel
(where available: <code>parallel = T</code>), in addition to the
standard timesteps and parameter list.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simparams</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="../reference/set_equilibrium.html">set_equilibrium</a></span><span class="op">(</span>init_EIR <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_few_reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation_with_repetitions.html">run_simulation_with_repetitions</a></span><span class="op">(</span></span>
<span>  timesteps <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  overrides <span class="op">=</span> <span class="va">simparams</span>,</span>
<span>  parallel<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_many_reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_simulation_with_repetitions.html">run_simulation_with_repetitions</a></span><span class="op">(</span></span>
<span>  timesteps <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  overrides <span class="op">=</span> <span class="va">simparams</span>,</span>
<span>  parallel<span class="op">=</span><span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate the data</span></span>
<span><span class="va">df_few</span> <span class="op">&lt;-</span> <span class="fu">aggregate_function</span><span class="op">(</span><span class="va">output_few_reps</span><span class="op">)</span></span>
<span><span class="va">df_many</span> <span class="op">&lt;-</span> <span class="fu">aggregate_function</span><span class="op">(</span><span class="va">output_many_reps</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_variation_function</span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_few</span>, title_str <span class="op">=</span> <span class="st">"Repetitions = 5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Median"</span>, <span class="st">"IQR"</span>, <span class="st">"95% CI"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, </span>
<span>       fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="va">cols</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, <span class="va">cols</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu">plot_variation_function</span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_many</span>, title_str <span class="op">=</span> <span class="st">"Repetitions = 50"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Variation_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Charles, Peter Winskill, Hillary Topazian, Joseph Challenger, Richard Fitzjohn, Richard Sheppard, Tom Brewer, Kelly McCain, Lydia Haile.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
